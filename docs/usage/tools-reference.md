# 工具参考手册

## 🔍 可用工具

RAG MCP服务器提供三个核心工具，每个工具都有特定的用途和最佳使用场景。

## 1. search_knowledge_base

### 功能
在本地知识库中搜索相关文档和信息。

### 参数
- `query` (string, 必需): 搜索查询字符串
- `top_k` (integer, 可选): 返回结果数量，默认5，范围1-20

### 使用场景
- 查找内部文档
- 搜索公司政策
- 检索技术规范
- 查询历史数据

### 示例用法

**基本搜索：**
```
搜索知识库中关于"API安全"的信息
```

**指定结果数量：**
```
搜索知识库中关于"数据库设计"的信息，返回10个结果
```

**具体查询：**
```
在知识库中查找"用户认证流程"的详细步骤
```

### 返回格式
```json
{
  "results": [
    {
      "content": "文档内容片段",
      "source": "文档来源",
      "score": 0.85,
      "metadata": {
        "file_path": "documents/api-guide.pdf",
        "page": 15,
        "section": "安全章节"
      }
    }
  ],
  "total_found": 5,
  "query_time": 0.123
}
```

## 2. web_search

### 功能
使用Perplexity或Exa API进行实时网络搜索。

### 参数
- `query` (string, 必需): 搜索查询字符串
- `max_results` (integer, 可选): 最大结果数，默认5，范围1-10

### 使用场景
- 获取最新新闻
- 查找实时信息
- 研究市场趋势
- 技术问题求解

### 示例用法

**新闻搜索：**
```
搜索最新的人工智能发展新闻
```

**技术查询：**
```
搜索Python 3.12的新特性
```

**市场研究：**
```
搜索2024年云计算市场趋势报告
```

### 返回格式
```json
{
  "results": [
    {
      "title": "搜索结果标题",
      "content": "内容摘要",
      "url": "https://example.com",
      "published_date": "2024-01-15",
      "source": "来源网站"
    }
  ],
  "search_time": 0.456,
  "backend": "perplexity"
}
```

## 3. smart_search

### 功能
结合知识库搜索和网络搜索的智能混合搜索。

### 参数
- `query` (string, 必需): 搜索查询字符串

### 使用场景
- 需要内外部信息结合
- 对比分析
- 全面研究
- 决策支持

### 示例用法

**对比分析：**
```
比较我们内部的销售策略与当前市场最佳实践
```

**全面研究：**
```
分析我们的技术栈与业界主流技术的优劣势
```

**决策支持：**
```
综合内部数据和外部趋势，评估新产品方向
```

### 返回格式
```json
{
  "knowledge_base_results": [...],
  "web_search_results": [...],
  "synthesis": "基于内部和外部信息的综合分析",
  "recommendations": ["建议1", "建议2"],
  "search_time": 0.789
}
```

## 最佳实践

### 查询优化

#### 知识库搜索
- 使用具体的关键词
- 避免过于宽泛的查询
- 包含相关的技术术语

**好的示例：**
```
JWT令牌验证实现方法
Docker容器部署配置
用户权限管理流程
```

**不推荐：**
```
如何做？
最好的方法
一般情况
```

#### 网络搜索
- 包含时间限定词
- 使用准确的产品/技术名称
- 指定信息类型

**好的示例：**
```
2024年React最新性能优化技巧
Kubernetes 1.28版本新功能
最新的网络安全威胁报告
```

#### 智能搜索
- 明确指出需要对比的方面
- 描述具体的业务场景
- 提及决策目标

**好的示例：**
```
对比我们当前的微服务架构与最新的云原生最佳实践
评估现有的数据分析工具与市场主流BI平台的差异
```

### 结果解释

#### 相似度分数
- 0.8-1.0: 高度相关
- 0.6-0.8: 相关
- 0.4-0.6: 部分相关
- <0.4: 低相关性

#### 结果排序
- 默认按相似度排序
- 可以按时间、来源等排序
- 权重算法考虑多个因素

### 错误处理

#### 常见错误类型
```json
{
  "error": "API_KEY_INVALID",
  "message": "OpenAI API密钥无效",
  "code": 401
}
```

```json
{
  "error": "SEARCH_TIMEOUT", 
  "message": "搜索请求超时",
  "code": 408
}
```

```json
{
  "error": "RATE_LIMIT_EXCEEDED",
  "message": "请求频率超限",
  "code": 429
}
```

#### 错误恢复策略
1. 检查API密钥配置
2. 降低请求频率
3. 简化查询条件
4. 检查网络连接

### 性能优化

#### 查询优化
- 使用缓存机制
- 合理设置top_k值
- 避免重复查询

#### 并发控制
- 限制同时请求数
- 实现请求队列
- 设置超时时间

#### 资源管理
- 定期清理缓存
- 监控内存使用
- 优化索引大小

## 使用限制

### API限制
- OpenAI API: 根据套餐限制
- 搜索API: 每月查询次数
- 并发请求: 最多5个

### 性能限制
- 单次查询最大10MB
- 响应时间目标: <3秒
- 缓存时间: 1小时

### 内容限制
- 不处理敏感信息
- 遵守内容政策
- 过滤恶意查询